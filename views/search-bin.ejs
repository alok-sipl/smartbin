<style>
#map-canvas { 
height: 500px; 
width: 900px;
}
</style>

<div>
<select onchange="resetbins()" name="select_area" onchange="getState(this.value)" id="select_ward" class="form-control">
<option value="">Search Bin</option>
<% if(Object.keys(areas).length){
for(var key in wards) { %>
<option value="<%= key %>"><%= wards[key].name %>
</option>
<% } } %>
</select>
</div>

<div id="map-canvas"></div>

<div class="hpanel">
<div class="panel-body">
<table  id="bin-grid-searchpage"></table>
<div id="bin-grid-pager-searchpage"></div>
</div>
</div>



<script>
var addresses = '';
var message = '';
var delay = 100;
var nextAddress = 0;
var infowindow = new google.maps.InfoWindow();
var geo = new google.maps.Geocoder();
var bounds = new google.maps.LatLngBounds();
var markers=[];
var latlng = new google.maps.LatLng(21.833524, 75.614989);
var mapOptions = {
zoom: 15,
center: latlng,
mapTypeId: google.maps.MapTypeId.ROADMAP
}
var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);






function filterbins() {
var select_ward = $('#select_ward').val();
var thisvalue = $("select#select_ward option:selected").text();

 $('#gs_ward_name').val(thisvalue);
 $('#gs_ward_name').keyup();
$.ajax({
url: '/bin/filterbins',
type: "post",
dataType: "json",
beforeSend: function() {
},
data: {selected_ward: select_ward},
cache: true,
error: function() {
},
success: function(e) {
$.each(e.bins, function(i, option) {
if (option.latitude != null && option.latitude != "") {

if(!option.latest_dust_level){
    option.latest_dust_level = 0;
}
var search = option.location +' (Dust Status: ' + option.latest_dust_level +')';
createmarkers(search, option.latitude, option.longitude, option.latest_dust_level , option.alert_level);
} else {
//console.log(option.lattitude+" else");
}
});
},
complete: function(jqXHR, textStatus) {

}
});
}

// Removes the markers from the map, but keeps them in the array.
function resetbins() {
setMapOnAll(null);
filterbins();
}

function setMapOnAll(map) {
for (var i = 0; i < markers.length; i++) {
markers[i].setMap(map);
}
}

function createmarkers(add, lat, lng, latest_dust_level, alert_level) {
if(latest_dust_level > alert_level)
{
var pinColor = "FE7569";
}
else
{
var pinColor = "34BA46";
}
var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
new google.maps.Size(21, 34),
new google.maps.Point(0,0),
new google.maps.Point(10, 34));

var contentString = add;

var marker = new google.maps.Marker({
position: new google.maps.LatLng(lat, lng),
map: map,
icon: pinImage,
});
map.setCenter(new google.maps.LatLng(lat, lng));
markers.push(marker);   

google.maps.event.addListener(marker, 'click', function() {
infowindow.setContent(contentString);
infowindow.open(map, marker);
});

google.maps.event.addListener(marker, 'mouseover', function() {
infowindow.setContent(contentString);
infowindow.open(map, marker);
});

bounds.extend(marker.position);
}

filterbins();
</script>